@model IEnumerable<BaseUser>


<div class="container-fluid py-4">
      <div class="row">
        <div class="col-lg-3 col-sm-6 mb-lg-0 mb-4">
            <div class="card">
                <div class="card-header p-3 pt-2">
                  <div class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                    <i class="material-icons opacity-10">person</i>
                  </div>
                  <div class="text-start pt-1">
                    <p class="text-sm mb-0 text-capitalize">حساب المدير العام </p>
                  </div>
                </div>
                <hr class="dark horizontal my-0">
                <div class="card-footer p-3">
                  <p class="mb-0 text-start">
                  <span class="text-success text-sm font-weight-bolder ms-1">
                      <a asp-area="" asp-controller="Account" asp-action="register" asp-route-accountType="1" >
                          تسجيل حساب جديد
                      </a>
                    </span>
                    </p>
                </div>
            </div>
        </div>
          <div class="col-lg-3 col-sm-6 mb-lg-0 mb-4">
            <div class="card">
                <div class="card-header p-3 pt-2">
                  <div class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                    <i class="material-icons opacity-10">person</i>
                  </div>
                  <div class="text-start pt-1">
                    <p class="text-sm mb-0 text-capitalize">حساب مشرف المشاريع </p>
                  </div>
                </div>
                <hr class="dark horizontal my-0">
                <div class="card-footer p-3">
                  <p class="mb-0 text-start">
                  <span class="text-success text-sm font-weight-bolder ms-1">
                      <a asp-area="" asp-controller="Account" asp-action="register"  asp-route-accountType="2" >
                          تسجيل حساب جديد
                      </a>
                    </span>
                    </p>
                </div>
            </div>
        </div>
          <div class="col-lg-3 col-sm-6 mb-lg-0 mb-4">
            <div class="card">
                <div class="card-header p-3 pt-2">
                  <div class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                    <i class="material-icons opacity-10">person</i>
                  </div>
                  <div class="text-start pt-1">
                    <p class="text-sm mb-0 text-capitalize">حساب سكرتير تنفيذي </p>
                  </div>
                </div>
                <hr class="dark horizontal my-0">
                <div class="card-footer p-3">
                  <p class="mb-0 text-start">
                  <span class="text-success text-sm font-weight-bolder ms-1">
                      <a asp-area="" asp-controller="Account" asp-action="register"  asp-route-accountType="3">
                          تسجيل حساب جديد
                      </a>
                    </span>
                    </p>
                </div>
            </div>
        </div>
          <div class="col-lg-3 col-sm-6 mb-lg-0 mb-4">
            <div class="card">
                <div class="card-header p-3 pt-2">
                  <div class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                    <i class="material-icons opacity-10">person</i>
                  </div>
                  <div class="text-start pt-1">
                    <p class="text-sm mb-0 text-capitalize">حساب شؤون موظفين</p>
                  </div>
                </div>
                <hr class="dark horizontal my-0">
                <div class="card-footer p-3">
                  <p class="mb-0 text-start">
                  <span class="text-success text-sm font-weight-bolder ms-1">
                      <a asp-area="" asp-controller="Account" asp-action="register"  asp-route-accountType="4">
                          تسجيل حساب جديد
                      </a>
                    </span>
                    </p>
                </div>
            </div>
        </div>
        
    </div>


    <div class="row mt-5">
          <div class="col-lg-3 col-sm-6 mb-lg-0 mb-4">
            <div class="card">
                <div class="card-header p-3 pt-2">
                  <div class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                    <i class="material-icons opacity-10">person</i>
                  </div>
                  <div class="text-start pt-1">
                    <p class="text-sm mb-0 text-capitalize">حساب تسويق</p>
                  </div>
                </div>
                <hr class="dark horizontal my-0">
                <div class="card-footer p-3">
                  <p class="mb-0 text-start">
                  <span class="text-success text-sm font-weight-bolder ms-1">
                      <a asp-area="" asp-controller="Account" asp-action="register"  asp-route-accountType="5">
                          تسجيل حساب جديد
                      </a>
                    </span>
                    </p>
                </div>
            </div>
        </div>
          <div class="col-lg-3 col-sm-6 mb-lg-0 mb-4">
            <div class="card">
                <div class="card-header p-3 pt-2">
                  <div class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                    <i class="material-icons opacity-10">person</i>
                  </div>
                  <div class="text-start pt-1">
                    <p class="text-sm mb-0 text-capitalize">حساب مراقب مشاريع </p>
                  </div>
                </div>
                <hr class="dark horizontal my-0">
                <div class="card-footer p-3">
                  <p class="mb-0 text-start">
                  <span class="text-success text-sm font-weight-bolder ms-1">
                      <a asp-area="" asp-controller="Account" asp-action="register"  asp-route-accountType="6">
                          تسجيل حساب جديد
                      </a>
                    </span>
                    </p>
                </div>
            </div>
        </div>
          <div class="col-lg-3 col-sm-6 mb-lg-0 mb-4">
            <div class="card">
                <div class="card-header p-3 pt-2">
                  <div class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                    <i class="material-icons opacity-10">person</i>
                  </div>
                  <div class="text-start pt-1">
                    <p class="text-sm mb-0 text-capitalize">حساب ماليه</p>
                  </div>
                </div>
                <hr class="dark horizontal my-0">
                <div class="card-footer p-3">
                  <p class="mb-0 text-start">
                  <span class="text-success text-sm font-weight-bolder ms-1">
                      <a asp-area="" asp-controller="Account" asp-action="register" asp-route-accountType="8">
                          تسجيل حساب جديد
                      </a>
                    </span>
                    </p>
                </div>
            </div>
        </div>

           <div class="col-lg-3 col-sm-6 mb-lg-0 mb-4">
            <div class="card">
                <div class="card-header p-3 pt-2">
                  <div class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                    <i class="material-icons opacity-10">person</i>
                  </div>
                  <div class="text-start pt-1">
                    <p class="text-sm mb-0 text-capitalize">حساب مهندس مشاريع</p>
                  </div>
                </div>
                <hr class="dark horizontal my-0">
                <div class="card-footer p-3">
                  <p class="mb-0 text-start">
                  <span class="text-success text-sm font-weight-bolder ms-1">
                      <a asp-area="" asp-controller="Account" asp-action="register"  asp-route-accountType="7">
                          تسجيل حساب جديد
                      </a>
                    </span>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="container-fluid py-4">

    <div class="card row ">
    <div class="d-flex justify-content-between align-items-center">
        <h4 class="mt-3">أسماء الموظفين</h4>
        <div class="tabel-search-box mt-4 ms-9" >
            <input type="text" class="employee-search table-search border-0" data-search="search-input"  placeholder="بحث بالأسم أو الكود" aria-label="Example text with button addon" aria-describedby="button-addon1">
            <button class="table-search" type="button" id="button-addon1">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>
      <div class="table-responsive">
        <table class="table align-items-center mb-0">
          <thead>
            <tr>
              <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">كود الموظف</th>
              <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">اسم الموظف</th>
              <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">رقم تلفون</th>
              <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7"></th>
         
            </tr>
          </thead>
          <tbody id="data-table">
                    @foreach(var record in Model)
                    {
                        <tr>
                            <td class="d-flex px-2">
                                <div class="my-auto">
                                    <h6 class="mb-0 text-xs" >@record.Code</h6>
                                </div>
                            </td>
                          <td>
                            <div class="d-flex px-2">
                              <div class="my-auto">
                                <h6 class="mb-0 text-xs">@record.FirstName @record.LastName</h6>
                              </div>
                            </div>
                          </td>
                          <td>
                            <p dir="rtl" class="text-xs font-weight-normal mb-0">@record.PhoneNumber</p>
                          </td>
                          <td class="align-middle">
                              <a class="text-secondary font-weight-bold text-xs" asp-area="" asp-action="detailsOfEmployee" asp-controller="Account" asp-route-userId="@record.Id">
                                <span class="material-symbols-outlined">
                                  <i title="تفاصيل" class="material-icons-round opacity-10">info</i>
                                </span>
                              </a>

                        <a class="del-record text-secondary font-weight-bold text-xs" data-id="@record.Id" href="#">
                            <span class="material-symbols-outlined">
                              <i title="مسح" class="material-icons-round opacity-10">delete</i>
                            </span>
                          </a> 
                          </td>
                    </tr>

                    }
          </tbody>
        </table>
      </div>
      </div>


          
</div>

@section Scripts {


    <script>

        $(document).on('change','.employee-search', function(){
            const inputEle = document.querySelector('[data-search="search-input"]')
               $.ajax({
                        url: `/account/index?userNameOrCode=${inputEle.value}&refresh=true`,
                        type:"Get",
                        success: (data) => {
                              $("#data-table").find("tr").remove();
                              data.forEach(element => {
                                  let dateHijri = element.createdAt;
                                  $("#data-table").append(`
                                      <tr>
                                        <td class="d-flex px-2">
                                            <div class="my-auto">
                                                <h6 class="mb-0 text-xs" >${element.code}</h6>
                                            </div>
                                        </td>
                                        <td>
                                        <div class="d-flex px-2">
                                            <div class="my-auto">
                                            <h6 class="mb-0 text-xs">${element.fullName}</h6>
                                            </div>
                                        </div>
                                        </td>
                                        <td>
                                        <p dir="rtl" class="text-xs font-weight-normal mb-0">${element.phoneNumber}</p>
                                        </td>
                                        <td class="align-middle">
                                            <a class="text-secondary font-weight-bold text-xs" href="/account/detailsOfEmployee?userId=${element.id}" >
                                            <span class="material-symbols-outlined">
                                                <i title="تفاصيل" class="material-icons-round opacity-10">info</i>
                                            </span>
                                            </a>

                                        <a class="del-record text-secondary font-weight-bold text-xs" data-id="${element.id}" >
                                                <span class="material-symbols-outlined">
                                                    <i title="مسح" class="material-icons-round opacity-10" >delete</i>
                                                </span>
                                            </a>
                                        </td>
                                    </tr>
                              
                                  `)
                              });


                        },
                        error: function (eventFromParam) {
                            Swal.fire({
                                title: 'خطأ اثناء البحث',
                            })
                        }
                    })
        });


        $(document).on('click','.del-record',function(){
            var id = $(this).data("id");
            var data = { id };
            Swal.fire({
              title: 'هل أنت متأكد من أنك تريد المسح؟',
              text: "أنت لا تستطيع ارجاع عن هذا الاجراء بعد ذلك",
              icon: 'warning',
              showCancelButton: true,
              confirmButtonColor: '#3085d6',
              cancelButtonColor: '#d33',
              confirmButtonText: 'نعم !',
              cancelButtonText: 'إالغاء !'
            }).then((result) => {
              if (result.isConfirmed) {
                  debugger;
                    $.ajax({
                        url: '/Account/DeleteConfirmed',
                        type:"POST",
                        contentType: 'application/x-www-form-urlencoded',
                        data: data,
                        success: (data) => {
                            $(this).parent().parent().remove();
                            Swal.fire(
                              'مسح!',
                              'تم المسح بنجاح.',
                              'تم'
                            )
                        },
                        error: function (eventFromParam) {
                            debugger;
                            console.log(eventFromParam.responseText);
                            console.log(eventFromParam.status);
                            console.log(eventFromParam.responseJSON);
                            console.log(eventFromParam.statusText);
                            Swal.fire({
                                title: 'خطأ اثناء المسح',
                                text:"يجب مسح العملاء المرتبطتين بهذا الموظف"
                            })
                        }
                    })
              }
            })
        });


    </script>
}